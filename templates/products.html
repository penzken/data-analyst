<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Uni Pro Admin - Product Analysis</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="static/global.css">
	<link
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
		rel="stylesheet"
	>
	<style>
		.sidebar-item { transition: all 0.3s ease; }
		.sidebar-item:hover { background-color: #f9fafb; color: #3b82f6; }
		.sidebar-item a.active { color: #3b82f6; background-color: #eff6ff; border-left: 3px solid #3b82f6; padding-left: calc(1rem - 3px); }
		.sidebar-item a.active .font-medium { font-weight: 600; }
	</style>
</head>
<body class="bg-gray-50 font-sans">
	<div class="flex h-[100dvh] overflow-hidden">
		<!-- Sidebar -->
		{{ sidebar|safe }}

		<!-- Main Content -->
		<div class="flex-1 flex flex-col overflow-hidden">
			<header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
				<h1 class="text-2xl font-semibold text-gray-800">Product Performance</h1>
			</header>

			<main class="flex-1 overflow-y-auto p-6">
				<div class="bg-white rounded-xl shadow-md p-6">
					<h2 class="text-lg font-bold text-gray-800 mb-4">Sales by Product</h2>
					<div class="overflow-x-auto">
						<table class="min-w-full divide-y divide-gray-200">
							<thead class="bg-gray-50">
								<tr>
									<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
										Product Name
									</th>
									<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
										Total Quantity Sold
									</th>
									<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
										Total Revenue
									</th>
								</tr>
							</thead>
							<tbody id="product-table-body" class="bg-white divide-y divide-gray-200">
								<!-- Data will be injected here by JavaScript -->
								<tr>
									<td colspan="3" class="text-center p-8 text-gray-500">Loading product data...</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</main>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			fetch('/api/product-analysis')
				.then((response) => response.json())
				.then((data) => {
					const tableBody = document.getElementById('product-table-body');
					tableBody.innerHTML = '';

					if (data.error) {
						tableBody.innerHTML = `<tr><td colspan="3" class="text-center p-8 text-red-500">${data.error}</td></tr>`;
						return;
					}

					if (data.length === 0) {
						tableBody.innerHTML = `<tr><td colspan="3" class="text-center p-8 text-gray-500">No product data found.</td></tr>`;
						return;
					}

					data.forEach((item) => {
						const row = `
							<tr class="hover:bg-gray-50">
								<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.item_name}</td>
								<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.total_quantity.toLocaleString()}</td>
								<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">$${item.total_revenue.toLocaleString()}</td>
							</tr>
						`;
						tableBody.innerHTML += row;
					});
				})
				.catch((error) => {
					console.error('Error fetching product data:', error);
					const tableBody = document.getElementById('product-table-body');
					tableBody.innerHTML = `<tr><td colspan="3" class="text-center p-8 text-red-500">Failed to load data.</td></tr>`;
				});
		});
	</script>
</body>
</html>
